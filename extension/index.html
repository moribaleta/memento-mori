<html>
    <head>
        <title>memnto.mori</title>
        <link rel="stylesheet" href="resources/css/loading.css">
        <link rel="stylesheet" href="resources/css/style.css">
        <link rel="stylesheet" href="resources/css/hamburger.css">
        <link rel="shortcut icon" href="resources/images/favicon.ico" type="image/x-icon">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="resources/js/jquery-3.2.1.min.js"></script>
    </head>
    <body> 
        <div class="cover">
            <img class=gif data-mode="video" src="resources/images/logo.gif" >
            <!--<span class="cssload-loader">
<span class="cssload-loader-inner"></span>
</span>-->
        </div>
        <div class="background">
            <iframe id='iframe_background' src="slideshow1.html" height="100%" width="100%"></iframe>
        </div>
        <div class="button_div">
            <button id="button" onclick='toggle()'>
                <img id="button_ic" src="resources/images/ic_search_white_48px.svg">
            </button>    
        </div>

        <div class="search">
            <div class='form'>
                <input type="text" id="text" name="q" placeholder="Google search" 
                       autofocus />
                <button id="button" onclick="submit()"> search </button>
            </div>
            <div class=time>
                <div class="date">
                </div>
                <div class="time_value">
                </div>
                <div class="weather">
                    <div class="location">
                        <span id="location_detail"></span>
                    </div>
                    <div class="forecast">weather:
                        <span id="forecast_detail"></span>
                    </div>
                </div>
            </div>
            <div class="hamburger hamburger--collapse js-hamburger">
                <div class="hamburger-box" >
                    <div class="hamburger-inner"></div>
                </div>
            </div>
            <div class='panel'>
                <div class="todo-title">To do</div>
                <iframe id="todolist" width="100%" height="100%" src="todolist.html"></iframe>
                <!--<div class="footer-panel"><a  href="resources/login.html">login</a>
                </div>-->
            </div>
        </div>
        <script>

            /*$(window).on('load',function(){
               $('.cover').hide();
            });*/



            $('#iframe_background').on('load',function(){
                setTimeout(function(){
                    $('.cover').css('animation','fadeout 1s');
                    setTimeout(function(){
                        $('.cover').hide();
                    },500);
                },1000);
            });

            var open_close = true;
            var button = document.getElementById('button_ic');
            var button_bg = document.getElementById('button');
            var text_input = document.getElementById('text');

            function toggle(){
                if(open_close){
                    $('.search').addClass('show');
                    $('.background').css('filter','blur(10px)');                    
                    open_close = false;   button.src="resources/images/ic_close_white_48px.svg";
                    $(button_bg).css('background','rgba(0,0,0,0)');
                    $('#text').focus();
                }else{     
                    text_input.value = "";
                    $('.search').addClass('close');
                    $('.background').css('filter','blur(0px)');
                    setTimeout(function(){
                        $('.search').removeClass('show');    
                        $('.search').removeClass('close');
                        $(button_bg).css('background','rgba(0,0,0,0.3)');
                    },200);                    
                    open_close = true;
                    button.src="resources/images/ic_search_white_48px.svg";
                }                
            }

            $(document).keypress(function (e) {
                if (e.which == 13) {
                    //alert('enter key is pressed');
                    submit();
                }
            });

            var interval = setInterval(function(){
                getTime();
            },1000);

            var d = new Date();
            var weekday = new Array(7);
            weekday[0] =  "Sunday";
            weekday[1] = "Monday";
            weekday[2] = "Tuesday";
            weekday[3] = "Wednesday";
            weekday[4] = "Thursday";
            weekday[5] = "Friday";
            weekday[6] = "Saturday";

            function getTime(){
                var time = new Date().toLocaleString();
                time = time.split(',');                
                var n = weekday[d.getDay()] +" "+ time[0];
                $('.date').html(n);
                $('.time_value').html(time[1]); 
            }
            getTime();

            var loc_detail =document.getElementById('location_detail');
            function getLocation() {
                if (navigator.geolocation) {                 navigator.geolocation.getCurrentPosition(showPosition);
                                           } else {
                                               alert("Geolocation is not supported by this browser.");
                                           }
            }


            function showPosition(position) {

                //$('#location_detail').textContent = position;
                var lat = position.coords.latitude;
                var long =position.coords.longitude;
               loc_detail.textContent = lat +" , "+ long;
                getWeather(lat,long);
                getMapPosition(lat,long);
            }

            function getMapPosition(lat,long){
                var url_path = "http://maps.googleapis.com/maps/api/geocode/json?latlng="+lat+","+long+"&sensor=false";
                $.ajax({
                    url: url_path,
                    success: function(response){
                        console.log('object %o',response);
                        loc_detail.textContent = response.results[0].formatted_address;
                    }
                })
            }

            getLocation();

            var weather_api_key = "b5a6920083fa28da23d7d2cc4c885820";
            var forecast_detail = document.getElementById('forecast_detail');

            function getWeather(lat,long){
                var url_path = "http://api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+long+"&APPID=b5a6920083fa28da23d7d2cc4c885820";
               // window.open(url_path,"_blank");
               /* var url_path = "api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+long+"&APPID="+weather_api_key;*/
                /*"api.openweathermap.org/data/2.5/forecast?
                id=524901&APPID="+weather_api_key;*/
                $.ajax({
                    url: url_path,
                    async:false,
                    success: function(response){
                        var data = response;
                        console.log('object %o',data);
                        var weather = data.weather[0].description;
                        forecast_detail.innerHTML = weather;
                        //console.log('object %o',data);
                    }
                })
            }



            function submit(){
                var value = document.getElementById('text').value;
                console.log(value);
                if(ValidURL(value)){
                    console.log('url');
                    //window.location.href = value;
                    value = "http://"+value;
                    window.open(value,'_blank');

                }else{
                    console.log('search');
                    var url ='http://www.google.com/search?q=' + value;
                    window.open(url,'_blank');  
                    //window.open('http://google.com/search?q='+value);
                }
            }

            function ValidURL(str) {
                var regex = /[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/;
                if(!regex .test(str)) {                
                    return false;
                } else {
                    return true;
                }
            }

            /*hamburger*/
            $('.hamburger').on("click",function(){
                this.classList.toggle("is-active");
                if($('.panel').css("display")=='block'){
                    setTimeout(function(){
                        $('.panel').css("display","none");    
                    },300);
                    $('.panel').css("animation",'fadeoutright .55s');                    
                }else{
                    $('.panel').css("animation",'fadeinright .3s');   
                    $('.panel').css("display","block");

                }
            });            
        </script>
         <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBymq4YRMhZoMwnPUd2SfyzQQLEvUtafkM&libraries=places&callback=getLocation"
                async defer></script>
    </body>
</html>
